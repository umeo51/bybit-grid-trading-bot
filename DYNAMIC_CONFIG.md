# 動的設定調整機能

このBOTは、資産額に応じて自動的にグリッド数や設定を最適化します。

## 資産額別の自動設定

| 資産額 (USDT) | グリッド数 | 価格範囲 | 最大ポジション比率 | 期待月利 | 説明 |
|--------------|-----------|---------|------------------|---------|------|
| 300-500 | 6 | ±3.0% | 85% | 1-2% | 保守的運用 |
| 500-800 | 10 | ±3.5% | 75% | 2-3% | バランス運用 |
| 800-1200 | 15 | ±4.0% | 70% | 3-4% | 標準運用 |
| 1200-2000 | 20 | ±4.5% | 65% | 4-5% | 積極運用 |
| 2000-5000 | 30 | ±5.0% | 60% | 5-6% | 高頻度運用 |
| 5000+ | 40 | ±5.0% | 55% | 6-7% | 最大効率運用 |

## 仕組み

### 1. 起動時の自動設定

BOT起動時に、現在の資産額を確認し、最適な設定を自動的に適用します。

```
資産額: 350 USDT
→ ティア: 300-500 USDT (保守的運用)
→ グリッド数: 6
→ 価格範囲: ±3.0%
→ 最大ポジション比率: 85%
```

### 2. 運用中の自動再調整

資産が増減し、別のティアに移行した場合、自動的に設定を再調整します。

**例1: 資産が増加した場合**

```
初期資産: 350 USDT → グリッド数: 6
↓ 利益が出て資産が増加
現在資産: 550 USDT → 自動的にグリッド数: 10に変更
```

**例2: 資産が減少した場合**

```
初期資産: 1500 USDT → グリッド数: 20
↓ 損失が出て資産が減少
現在資産: 750 USDT → 自動的にグリッド数: 10に変更（リスク軽減）
```

### 3. 再調整のタイミング

メインループ（60秒ごと）で資産額をチェックし、ティアが変わった場合に自動的に再調整します。

## 計算例

### 300 USDT の場合

```
資産額: 300 USDT
レバレッジ: 2倍
最大ポジション比率: 85%
グリッド数: 6

1グリッドあたりの注文サイズ:
= 300 * 2 * 0.85 / 6
= 85 USDT per grid
= 0.000885 BTC (BTC価格 = 96,000 USDの場合)

Bybit最小注文サイズ: 0.001 BTC
→ 若干不足していますが、価格変動により調整されます
```

### 500 USDT の場合

```
資産額: 500 USDT
レバレッジ: 2倍
最大ポジション比率: 75%
グリッド数: 10

1グリッドあたりの注文サイズ:
= 500 * 2 * 0.75 / 10
= 75 USDT per grid
= 0.000781 BTC

→ まだ最小値未満
```

### 1000 USDT の場合

```
資産額: 1000 USDT
レバレッジ: 2倍
最大ポジション比率: 70%
グリッド数: 15

1グリッドあたりの注文サイズ:
= 1000 * 2 * 0.70 / 15
= 93.3 USDT per grid
= 0.000972 BTC

→ ほぼ最小値に到達
```

### 2000 USDT の場合

```
資産額: 2000 USDT
レバレッジ: 2倍
最大ポジション比率: 65%
グリッド数: 20

1グリッドあたりの注文サイズ:
= 2000 * 2 * 0.65 / 20
= 130 USDT per grid
= 0.001354 BTC

→ 最小値をクリア！理想的な運用が可能
```

## 推奨資産額

**最低**: 300 USDT（動作はするが、グリッド数が少なく取引頻度が低い）
**推奨**: 1000 USDT以上（安定した運用が可能）
**理想**: 2000 USDT以上（月利4-5%を狙える）

## 注意事項

### 1. 最小注文サイズの制約

Bybitの最小注文サイズ（0.001 BTC ≈ 96 USDT）により、300-1000 USDTの範囲では注文サイズが制約を受ける可能性があります。

### 2. 再調整時の既存注文

ティアが変わって再調整が行われる際、既存の未約定注文はすべてキャンセルされ、新しい設定でグリッドが再構築されます。

### 3. 頻繁な再調整を避ける

ティアの境界付近（例: 495-505 USDT）で資産が変動すると、頻繁に再調整が発生する可能性があります。これを避けるため、ティアの境界には一定のバッファを設けています。

## 手動設定との併用

`config/config.yaml`の設定は、起動時の初期値として使用されますが、動的設定調整機能により自動的に上書きされます。

手動で固定の設定を使用したい場合は、`src/main.py`の動的設定調整機能をコメントアウトしてください。

## ログ出力例

```
2025-12-11 19:30:00 - GridBot - INFO - Available balance: 350.00 USDT
2025-12-11 19:30:00 - GridBot - INFO - ============================================================
2025-12-11 19:30:00 - GridBot - INFO - Applying dynamic configuration based on balance...
2025-12-11 19:30:00 - GridBot - INFO - ============================================================
2025-12-11 19:30:00 - GridBot - INFO - Balance tier: 300-500 USDT: 保守的運用
2025-12-11 19:30:00 - GridBot - INFO - Optimal grid count: 6
2025-12-11 19:30:00 - GridBot - INFO - Price range: ±3.0%
2025-12-11 19:30:00 - GridBot - INFO - Max position ratio: 85%
2025-12-11 19:30:00 - GridBot - INFO - 
============================================================
Current Tier: 300-500 USDT: 保守的運用
Balance Range: 300-500 USDT
Grid Count: 6
Price Range: ±3.0%
Max Position: 85%
Leverage: 2x
============================================================
```

## まとめ

この動的設定調整機能により、資産が増えるにつれて自動的により効率的な運用に移行し、逆に資産が減った場合はリスクを抑えた運用に自動的に切り替わります。

**手間なく、資産額に最適化された運用が可能です。**
