# Bybit Grid Trading Bot - 月利5%目標

## 1. 概要

このプロジェクトは、Bybitのデリバティブ市場（無期限契約）で動作する、Python製のグリッドトレーディングBOTです。月利5%の安定した収益を目指し、以下の特徴を持っています。

- **動的グリッド戦略**: ATR（Average True Range）を利用して、市場のボラティリティに応じてグリッドの価格範囲を自動で調整します。
- **高度なリスク管理**: 日次損失限界、最大ドローダウン、ポジションサイズ制限など、複数の安全機能を搭載しています。
- **手数料最適化**: すべての注文を「PostOnly」（メイカー注文）として発注し、手数料を最小限に抑えます。
- **モジュール設計**: 機能ごとにコードが分割されており、カスタマイズや機能追加が容易です。
- **詳細なロギング**: 取引履歴、パフォーマンス、エラーなどを詳細に記録し、運用状況を追跡できます。

**注意**: このBOTは教育目的で作成されており、利益を保証するものではありません。実際の資金で運用する前に、必ずテストネットで十分にテストしてください。

## 2. セットアップ方法

### 2.1. 前提条件

- Python 3.8以上
- Bybitアカウント
- Bybit APIキー（テストネットまたは本番）

### 2.2. インストール手順

1.  **リポジトリをクローンまたはダウンロード**

    ```bash
    git clone <リポジトリURL> bybit_grid_bot
    cd bybit_grid_bot
    ```

2.  **APIキーを設定**

    `config/.env.example` を `config/.env` にコピーし、ご自身のBybit APIキーとシークレットキーを記入してください。

    ```bash
    cp config/.env.example config/.env
    ```

    ```.env
    # Bybit API Credentials
    BYBIT_API_KEY=your_api_key_here
    BYBIT_API_SECRET=your_api_secret_here
    ```

    **重要**: APIキーを作成する際は、**出金権限を絶対に有効にしないでください**。

    **注意**: 現在、テストネット環境では認証エラーが発生するため、**本番環境での使用を前提としています**。必ず少額から開始してください。

3.  **設定ファイルを編集（オプション）**

    `config/config.yaml` ファイルで、取引ペア、レバレッジ、グリッド数などの詳細な設定を変更できます。詳細は後述の「4. 設定ファイル解説」を参照してください。

## 3. 実行方法

以下のスクリプトを実行するだけで、必要な依存関係のインストールからBOTの起動までが自動で行われます。

```bash
./run.sh
```

BOTを停止するには、ターミナルで `Ctrl + C` を押してください。安全に停止処理が行われます。

## 4. 設定ファイル解説 (`config.yaml`)

BOTの挙動は `config/config.yaml` ファイルで細かく調整できます。

| セクション | パラメータ | 説明 |
|:---|:---|:---|
| `api` | `testnet` | `false`に設定してください（本番環境のみ対応）。**必ず少額から開始してください。** |
| `trading` | `symbol` | 取引ペア（例: "BTCUSDT"） |
| | `leverage` | レバレッジ倍率（1〜10を推奨） |
| `grid` | `count` | グリッドの数。多いほど取引頻度が上がりますが、1回あたりの利益は減ります。（20〜40推奨） |
| | `range_percent` | 固定レンジの場合の価格範囲（例: 0.05 = ±5%） |
| | `use_dynamic_range` | `true`にするとATRに基づいた動的レンジを使用します。 |
| `risk` | `max_position_ratio` | 総資金のうち、取引に使用する最大割合。（0.6 = 60%） |
| | `daily_loss_limit` | 1日の損失がこの割合に達するとBOTが緊急停止します。（0.05 = 5%） |
| | `max_drawdown` | 資産のピークからの下落率がこの値に達すると緊急停止します。（0.15 = 15%） |
| `execution` | `check_interval` | メインループの実行間隔（秒）。（60推奨） |

## 5. ログの確認

BOTの動作状況は `logs/` ディレクトリに保存されます。

-   `bot_YYYY-MM-DD.log`: 詳細な動作ログ、エラーログ
-   `trades_YYYY-MM-DD.csv`: 取引履歴（CSV形式）

## 6. アーキテクチャ

このBOTは、以下のモジュールで構成されています。

-   `main.py`: 全体を制御するメインコントローラー
-   `config.py`: 設定ファイルの読み込みと管理
-   `logger.py`: ログ出力
-   `bybit_client.py`: Bybit APIとの通信
-   `market_analyzer.py`: 市場データの分析（ATR計算など）
-   `grid_strategy.py`: グリッド戦略のロジック
-   `risk_manager.py`: リスク管理
-   `position_manager.py`: ポジションと注文の管理

## 7. カスタマイズ（上級者向け）

### 7.1. 取引戦略の変更

`src/grid_strategy.py` や `src/market_analyzer.py` を編集することで、独自のロジックを追加できます。

-   **例1：レンジ相場判定の強化**
    `market_analyzer.py` の `is_range_market()` に、ADXなどの他のテクニカル指標を追加して判定精度を向上させる。

-   **例2：利益確定ロジックの追加**
    `risk_manager.py` の `check_daily_profit_target()` が `True` を返した際に、`main.py` でポジションの一部を利確する処理を追加する。

### 7.2. バックテスト機能

このプロジェクトにはバックテスト機能は含まれていませんが、`bybit_client.py` を改造して過去のローソク足データを読み込むようにし、`main_loop` を修正することで実装可能です。

## 8. 免責事項

本ソフトウェアは、作者がその動作を保証するものではありません。本ソフトウェアを使用したことによって生じたいかなる損害についても、作者は一切の責任を負いません。投資は自己責任でお願いします。
